<html>
    <head>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
        <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
        <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

        <script src="../src/L.Deflate.js"></script>
        <style>
            #map {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }
        </style>
    </head>

    <div id="map"></div>

    <script>


    window.onload = function () {
        const TEXAS_CENTER = [31.616350252730477, -99.20710987096106];
        const GEOJSON_URL = 'https://raw.githubusercontent.com/OpenDataDE/State-zip-code-GeoJSON/master/';
        const state = 'tx_texas';
        const url = GEOJSON_URL + state + '_zip_codes_geo.min.json';
        console.log(url);

        var map = L.map("map").setView(TEXAS_CENTER, 5);

        L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var polygonLayer = L.layerGroup();
        var markerLayer = L.layerGroup();
        // var features = L.deflate({minSize: 1, markerLayer: polygonLayer});
        // features.addTo(map);

        map.on('zoomend', function () {
            if (map.getZoom() > 9 && map.hasLayer(polygonLayer)) {
                map.removeLayer(polygonLayer);
                map.addLayer(markerLayer);
            }
            if (map.getZoom() <= 9 && map.hasLayer(polygonLayer) == false) {
                map.addLayer(polygonLayer);
                map.removeLayer(markerLayer);
            }
        });
        map.addLayer(polygonLayer);
        map.removeLayer(markerLayer);

        fetch('polygons.json').then(r => r.json()).then(polys => {
            polys.forEach(poly => {
                L.polygon(poly).addTo(polygonLayer);

                L.marker(poly[0]).addTo(markerLayer);
            });
        });
    }
    </script>
</html>
